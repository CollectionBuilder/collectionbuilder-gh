---
# generate geojson data for collection items with lat-longs
---
{%- assign items = site.data[site.metadata] | where_exp: 'item','item.latitude' -%}
{%- assign fields = site.data.theme.metadata-export-fields | split: "," -%}
{
    "type": "FeatureCollection",
    "features": [ 
        {% for item in items %}
        {
            "type":"Feature",
            "geometry":{
                "type":"Point",
                "coordinates":[{{ item.longitude }},{{ item.latitude }}]
            },            
            "properties":{
                {% for f in fields %}{% if item[f] %}{{ f | jsonify }}: {{ item[f] | jsonify }},{% endif %}
                {% endfor %}
                "reference_url": {% if item.parentid %}{{ '/item.html' | absolute_url | append: '?id=' | append: item.parentid | jsonify }}{% else %}{{ '/item.html' | absolute_url | append: '?id=' | append: item.objectid | jsonify }}{% endif %}
            }
        }{% unless forloop.last %}, {% endunless %}{% endfor %}
    ]
}
